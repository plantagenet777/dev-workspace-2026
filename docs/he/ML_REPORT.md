## דוח ML: Random Forest ניטור משאבה

מסמך זה מסכם את הגדרות ה-ML הנוכחיות ואת תוצאות הולידציה של מנוע התחזוקה החיזויית.

### 1. מערך נתונים

- **מקור:** נתונים סינתטיים שנוצרים על ידי `train_and_save.py`.
- **התאמה לדומיין:** הגנרטור הסינתטי משתמש ב-`Config.HEALTHY_MEANS`, `WARNING_MEANS`, `CRITICAL_MEANS` ובספי רעידות מ-`config/config.py`; שלוש המחלקות עקביות עם:
  - אזורי רעידות ISO 10816-3 (B, C, D);
  - ספי הוראות הפעלה למשאבות slurry (לחץ, זרם, טמפרטורה).
- **גודל:** ברירת מחדל `samples=5000`.
- **איזון מחלקות (בתכנון):**
  - Healthy (0): 80%
  - Warning (1): 10%
  - Critical (2): 10%

המנוע משתמש ב-8 תכונות:

- `vib_rms`, `vib_crest`, `vib_kurtosis`
- `current`, `pressure`
- `cavitation_index`
- `temp`, `temp_delta`

אלו בדיוק `Config.FEATURE_NAMES` באימון ובהסקה.

### 2. מודל

המודל הנוכחי הוא `RandomForestClassifier` של scikit-learn:

- `n_estimators=150`
- `max_depth=10`
- `class_weight="balanced"`
- `random_state=42`

התכונות מנורמלות עם `StandardScaler`. ארטיפקטים נשמרים כ:

- מודל: `models/pump_rf_<MODEL_VERSION>.joblib`
- scaler: `models/scaler_<MODEL_VERSION>.joblib`

### 3. פרוטוקול הערכה

`train_and_save.py` משתמש בפרוטוקול:

- יצירת מערך סינתטי (seed = 42);
- פיצול **80% train / 20% validation** עם סטרטיפיקציה לפי מחלקה;
- התאמת scaler ומודל רק על train;
- הערכה על validation: balanced accuracy, precision/recall/F1 לפי מחלקה, מטריצת בלבול, חשיבות תכונות.

דוח טקסט נכתב ל:

```text
models/ml_report.txt
```

ומודפס ל-stdout. להרצה מחדש:

```bash
make train
# או:
PYTHONPATH=. ./venv/bin/python train_and_save.py
```

### 4. מדדי ולידציה נוכחיים (סינתטי)

בריצה האחרונה (seed 42, 5000 דגימות):

- **Balanced accuracy:** 1.0000

התוצאה המושלמת צפויה על נתונים גאוסיים סינתטיים עם ממוצעים מופרדים היטב. היא **לא** מבטיחה איכות זהה על נתוני מפעל אמיתיים, אך מאשרת:

- עקביות תוויות ותכונות;
- יכולת המודל להבחין בין שלוש האזורים בספים הנוכחיים.

### 5. חשיבות תכונות

מאותה ריצה: תכונות רעידות (`vib_kurtosis`, `vib_rms`, `vib_crest`) ומשתני תהליך (`temp`, `pressure`, `cavitation_index`) דומיננטיות; `current` ו-`temp_delta` משניות. זה עקבי עם לוגיקת הכללים.

### 6. השפעה עסקית (אילוסטרטיבית)

למשאבת slurry אחת במעגל קריטי (אומדן):

- 2–3 כשלים לא מתוכננים בשנה, 4–8 שעות השבתה כל אחד;
- עלות שעת ייצור אבודה במעגל טחינה/ציפה — בסדר גודל **\$5k–\$20k**;
- אם מנוע ה-PdM מאפשר למנוע **1–2** אירועים כאלה בשנה — הפסדים נמנעים בסדר גודל **\$40k–\$200k/שנה למשאבה**, בלי להכליל נזק מכני מופחת.

מטרת המודל וסט הכללים:

- להציג התראות ברורות וניתנות להסבר (מה קרה ולמה);
- להעביר החלטות מתגובה בלבד (trip → חקירה) להתערבויות מתוכננות מבוססות נתונים (אזור WARNING עם הקשר).

### 7. מגבלות וצעדים הבאים

- **סינתטי בלבד.** המדדים מחושבים על נתונים סינתטיים; נתוני מפעל אמיתיים עשויים להכיל רעש, דריפט וקשרים שונים.
- **אין Time-series CV.** משתמשים בפיצול אקראי; לנתוני series בזמן מתאים walk-forward validation.
- **הסטת דומיין.** שינוי ספים או HEALTHY_MEANS / WARNING_MEANS / CRITICAL_MEANS מחייב אימון מחדש (`make train`).

צעדים מומלצים לפריסת ייצור:

- איסוף ותיוג טלמטריה אמיתית מהמפעל;
- אימון והערכה מחדש על נתונים אמיתיים עם פיצולים תלויי זמן;
- ניטור התפלגויות ציונים ודריפט (למשל ניתוח תקופתי של `telemetry_history.csv`).
