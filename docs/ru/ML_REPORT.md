## ML-отчёт: Random Forest Pump Monitor

В документе кратко описаны текущая ML-настройка и результаты валидации движка предиктивного обслуживания.

### 1. Датасет

- **Источник:** синтетические данные, генерируемые `train_and_save.py`.
- **Согласованность с доменом:** генератор использует
  `Config.HEALTHY_MEANS`, `WARNING_MEANS`, `CRITICAL_MEANS` и пороги вибрации
  из `config/config.py`; три класса согласованы с:
  - зонами вибрации ISO 10816-3 (B, C, D);
  - порогами инструкции по эксплуатации шламовых насосов (давление, ток, температура).
- **Размер:** по умолчанию `samples=5000`.
- **Баланс классов (по замыслу):**
  - Healthy (0): 80%
  - Warning (1): 10%
  - Critical (2): 10%

Используются 8 признаков:

- `vib_rms`, `vib_crest`, `vib_kurtosis`
- `current`, `pressure`
- `cavitation_index`
- `temp`, `temp_delta`

Это те же `Config.FEATURE_NAMES`, что при обучении и при инференсе.

### 2. Модель

Текущая модель — scikit-learn `RandomForestClassifier`:

- `n_estimators=150`
- `max_depth=10`
- `class_weight="balanced"`
- `random_state=42`

Признаки нормируются с помощью `StandardScaler`. Артефакты сохраняются как:

- модель: `models/pump_rf_<MODEL_VERSION>.joblib`
- скалер: `models/scaler_<MODEL_VERSION>.joblib`

### 3. Протокол оценки

В `train_and_save.py` используется протокол:

- генерация синтетического датасета (seed = 42);
- разбиение **80% train / 20% validation** с стратификацией по классам;
- обучение скалера и модели только на train;
- оценка на validation: balanced accuracy, precision/recall/F1 по классам, confusion matrix, важность признаков.

Текстовый отчёт записывается в:

```text
models/ml_report.txt
```

и выводится в stdout. Для пересчёта:

```bash
make train
# или:
PYTHONPATH=. ./venv/bin/python train_and_save.py
```

### 4. Текущие метрики валидации (синтетика)

При последнем запуске (seed 42, 5000 сэмплов):

- **Balanced accuracy:** 1.0000

Идеальный результат ожидаем на синтетических гауссовых данных с хорошо разделёнными средними. Он **не** гарантирует того же на реальных данных завода, но подтверждает:

- согласованность меток и признаков;
- способность модели различать три зоны при текущих порогах.

### 5. Важность признаков

Из того же запуска (сокращённо):

- vib_kurtosis, vib_rms, temp, pressure, cavitation_index — основные;
- vib_crest, current, temp_delta — второстепенные.

Это согласуется с правилами: вибрация, температура и давление — основные индикаторы перехода Healthy → Warning → Critical.

### 6. Бизнес-эффект (иллюстративно)

Для одного шламового насоса на критическом контуре (оценочно):

- 2–3 незапланированных отказа в год по 4–8 часов простоя;
- стоимость часа потерянной продукции на измельчении/флотации — порядка **\$5k–\$20k**;
- если PdM позволяет предотвратить **1–2** таких события в год, избежанные потери — порядка **\$40k–\$200k/год на насос**, без учёта снижения механических повреждений.

Цель модели и набора правил:

- давать понятные, объяснимые алерты (что произошло и почему);
- переводить решения от чисто реактивных (трип → расследование) к плановым вмешательствам по данным (зона WARNING с контекстом).

### 7. Ограничения и дальнейшие шаги

- **Только синтетика.** Метрики получены на синтетических данных; реальные данные завода могут иметь другой шум, дрифт и корреляции.
- **Нет временной кросс-валидации.** Используется случайное разбиение; для временных рядов уместна walk-forward валидация.
- **Сдвиг домена.** При изменении порогов или HEALTHY_MEANS / WARNING_MEANS / CRITICAL_MEANS нужно переобучить модель (`make train`).

Рекомендуемые шаги для промышленного внедрения:

- сбор и разметка реальной телеметрии завода;
- переобучение и оценка на реальных данных с учётом времени;
- мониторинг распределений оценок и дрифта (например, по `telemetry_history.csv`).
