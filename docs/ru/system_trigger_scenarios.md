# Сценарии срабатывания системы PdM (мониторинг насоса)

В документе перечислены все сценарии, при которых система выдаёт предупреждения (WARNING), критические состояния (CRITICAL) или выполняет автоматический блок/останов (SHUTDOWN). Пороги и тексты сообщений заданы в `config/config.py`; логика реализована в `app/predictor.py` и `simulate_failure.py`.

**Принципы:**

- Тип автоматического блока и сообщение определяются **только причиной** (поле `reason` предиктора или условие по датчикам). События не перекрывают друг друга; блок всегда соответствует диагностированной причине.
- **Риск только от модели (Elevated/High risk) сам по себе не вызывает автоматический останов.** Все SHUTDOWN привязаны к физическим/инженерным причинам (вибрация, кавитация, забивка, перегрев, удар частиц).

---

## 1. Автоматические блоки (SHUTDOWN)

Блок срабатывает только при совпадении **причины**; в сообщении явно указана причина (например «AUTOMATIC BLOCK — Cause: …»).

### 1.1 Вибрационный блок (interlock)

| Условие | Отображаемая вибрация **vib_display** ≥ `VIBRATION_INTERLOCK_MMPS` (по умолчанию 9.0 мм/с, **выше** входа в зону D по ISO 7.1 мм/с) **и** причина от предиктора — вибрация (Zone D / INTERLOCK), не кавитация, забивка, температура или debris. |
| Сообщение | `[AUTOMATIC BLOCK] Cause: vibration interlock (engineering limit). Vibration X.XX mm/s — trip limit exceeded.` |
| Где проверяется | `simulate_failure.py` после предиктора (по причине). Скриншоты CLI: [ARCHITECTURE.md](ARCHITECTURE.md#5-скриншоты-симуляции). |

### 1.2 Удар частиц (debris / механическое повреждение)

| Условие | Предиктор возвращает **CRITICAL** с reason = `MECHANICAL_DAMAGE_ALERT_MESSAGE` или `DEBRIS_IMPACT_ALERT_MESSAGE` (DEBRIS IMPACT Zone D). |
| Сообщение | `[DEBRIS IMPACT SHUTDOWN] Debris impact (stone hit, Zone D). Immediate stop.` + REPAIR (осмотр рабочего колеса, футеровки; не запускать без осмотра) + **Restart only after manual inspection and operator clearance.** |
| Где проверяется | `simulate_failure.py` после предиктора. |

### 1.3 Забивка нагнетания (choked discharge)

| Условие | Предиктор возвращает **CRITICAL** с причиной, начинающейся с **"CHOKED DISCHARGE"**. |
| Сообщение | `[AUTOMATIC BLOCK] Cause: choked discharge (low flow + high P/T). Overheat risk. Immediate stop.` |
| Где проверяется | `simulate_failure.py` после предиктора. |

### 1.4 Кавитация

| Условие | Предиктор возвращает **CRITICAL** с reason = `CAVITATION_ALERT_MESSAGE`, удержание не менее **CAVITATION_AUTO_SHUTDOWN_SEC** (по умолчанию 10 с). |
| Сообщение | `[AUTOMATIC BLOCK] Cause: cavitation sustained 10 s. Check inlet valve / sump level.` |
| Где проверяется | `simulate_failure.py` (таймер кавитации). |

### 1.5 Перегрев (overtemperature)

| Условие | Причина от предиктора — **HIGH TEMPERATURE** **и** средняя температура **T ≥ 75°C** не менее **TEMP_CRITICAL_AUTO_SHUTDOWN_SEC** (10 с). |
| Сообщение | `[OVERTEMPERATURE SHUTDOWN] Elevated temperature — overtemperature (T >= 75°C sustained 10 s).` При одновременной вибрации ≥ **VIBRATION_INTERLOCK_MMPS** — комбинированное сообщение. |
| Где проверяется | `simulate_failure.py` (таймер температуры). |

---

## 2. Критические состояния (CRITICAL) без обязательного SHUTDOWN

Предиктор выставляет статус CRITICAL и причину; автоматический останов для них может применяться отдельно (раздел 1).

### 2.1 DEBRIS IMPACT

| Условие | Флаг **debris_impact** в телеметрии **или** высокий crest (≥ 6.0) при вибрации Zone D или уже CRITICAL, **или** гистерезис с механической причиной. |
| Пороги | Вибрация Zone D: ≥ 7.1 мм/с. Crest ≥ 6.0. |
| Сообщение | DEBRIS IMPACT (Zone D): осмотр рабочего колеса, футеровки; не запускать без осмотра при подозрении на повреждение. |

### 2.2 CAVITATION

| Условие | Ток ≥ **54 A**, давление ≤ **4.0 бар**, вибрация ≥ **9.0 мм/с** (сглаженные или последние); или выход по гистерезису (давление ≤ 4.5 бар при сохранении условий по вибрации/току). |
| Сообщение | CAVITATION (Zone D): проверить впускной клапан / уровень в зумпфе. |

### 2.3 CHOKED DISCHARGE

| Условие | Ток ≤ **38 A**, давление ≥ **7.0 бар**, температура ≥ **70°C** (сглаженные или последние). |
| Сообщение | CHOKED DISCHARGE: P=… бар, T=…°C, I=… A — низкий расход + высокие P/T. Риск перегрева. Немедленная остановка. |

### 2.4 HIGH TEMPERATURE (Zone D)

| Условие | Температура ≥ **75°C** (сглаженная или последняя). |
| Сообщение | HIGH TEMPERATURE (Zone D): …°C — проверить охлаждение и расход. |

### 2.5 VIBRATION Zone D (ISO 10816-3)

| Условие | Вибрация (RMS) ≥ **7.1 мм/с**. При отсутствии более приоритетной причины выставляется сообщение по вибрации. Это CRITICAL **алерт**, не обязательно трип. |
| Сообщение | VIBRATION (Zone D): ≥7.1 мм/с недопустимо; снизить нагрузку или остановить для осмотра. |

### 2.6 Вибрационный блок (инженерный предел в предикторе)

| Условие | Вибрация ≥ **VIBRATION_INTERLOCK_MMPS** из Config (по умолчанию **9.0 мм/с**, выше границы Zone D 7.1 мм/с). |
| Действие | Принудительно CRITICAL, риск 99.9%. Сообщение: превышен предел останова; остановить и осмотреть. |

### 2.7 Высокий риск (модель)

| Условие | Статус CRITICAL от модели, но последняя причина была "MAINTENANCE (Zone C)" — заменяется общим сообщением о высоком риске. |
| Сообщение | High risk (model): inspect equipment. |
| Автоостанов | **Нет** — только рекомендация; трипы задаются физическими причинами из раздела 1. |

### 2.8 Гистерезис CRITICAL по вибрации

| Условие | Предыдущий шаг — CRITICAL; текущая вибрация < **6.0 мм/с**. Статус остаётся CRITICAL до **5** подряд шагов с низкой вибрацией, затем разрешён переход в WARNING. |

---

## 3. Предупреждения (WARNING)

### 3.1 MAINTENANCE / Degradation (Zone C) — износ рабочего колеса

| Условие | Ток ≤ **40 A** и давление ≤ **5.2 бар** (сглаженные и последние). Или гистерезис: был WARNING и ток/давление ещё не выше зоны выхода (ток < 42 A или давление < 5.5 бар). |
| Сообщение | MAINTENANCE (Zone C): P=… бар, I=… A — осмотр рабочего колеса и изнашиваемых элементов при останове. |

### 3.2 HIGH TEMPERATURE (Zone C)

| Условие | Температура ≥ **60°C**, статус иначе HEALTHY. |
| Сообщение | HIGH TEMPERATURE (Zone C): …°C — проверить охлаждение и расход. |

### 3.3 Перегрузка двигателя

| Условие | Ток ≥ **50 A**, статус HEALTHY. |
| Сообщение | Motor overload: inspect for motor strain. |

### 3.4 Высокое давление нагнетания

| Условие | Давление ≥ **7.0 бар** и ток **> 38 A** (не сценарий choked). Статус HEALTHY. |
| Сообщение | High discharge pressure: check discharge valves. |

### 3.5 Захват воздуха (air ingestion)

| Условие | Crest вибрации ≥ **5.5** **и** RMS вибрации ≥ **4.5 мм/с**. Статус иначе HEALTHY. |
| Сообщение | AIR INGESTION: check sump level, reduce speed. |

### 3.6 VIBRATION Zone C (ISO 10816-3)

| Условие | Вибрация ≥ **5.5 мм/с** (сглаженная и последняя), сглаженная вероятность ≥ **0.15**, статус иначе HEALTHY. Или гистерезис: был WARNING и вибрация ≥ **4.5 мм/с**. |
| Сообщение | VIBRATION (Zone C): запланировать обслуживание; следить за трендом. |

### 3.7 Повышенный риск (модель)

| Условие | Предыдущий шаг — WARNING, текущий статус модели HEALTHY, но сглаженная вероятность ≥ **0.25**. Остаёмся в WARNING. |
| Сообщение | Elevated risk (model): continue monitoring. |

---

## 4. Сводка порогов по умолчанию (config)

| Параметр | По умолчанию | Назначение |
|----------|--------------|------------|
| VIBRATION_CRITICAL_MMPS | 7.1 | ISO 10816-3 Zone D, алерт CRITICAL. |
| VIBRATION_WARNING_ENTRY_MMPS | 5.5 | ISO 10816-3 Zone C, вход в WARNING. |
| VIBRATION_INTERLOCK_MMPS | 9.0 | Вибрационный трип (инженерный предел, выше Zone D). |
| CHOKED_CURRENT_MAX_AMP | 38 | Забивка: верхняя граница тока. |
| CHOKED_PRESSURE_MIN_BAR | 7.0 | Забивка: нижняя граница давления. |
| CHOKED_TEMP_MIN_C | 70.0 | Забивка: нижняя граница температуры. |
| TEMP_WARNING_C | 60 | Температура Zone C. |
| TEMP_CRITICAL_C | 75 | Температура Zone D; автоостанов после удержания. |
| CAVITATION_* | 54 A, 4 бар, 9 мм/с | Кавитация. |
| DEGRADATION_* | 40 A, 5.2 бар | Zone C деградация/обслуживание. |
| OVERLOAD_CURRENT_MIN_AMP | 50 | Предупреждение перегрузки. |
| PRESSURE_HIGH_WARNING_BAR | 7.0 | Высокое давление при нормальном токе. |

---

*Документ основан на `config/config.py`, `app/predictor.py` и `simulate_failure.py`. Пороги соответствуют ISO 10816‑3 для зон вибрации и рекомендациям по эксплуатации насосов; interlock намеренно установлен выше Zone D для дополнительного шага безопасности перед жёстким трипом.*
